# Modbus 智能扫描工具 - 开发计划

## 一、项目概览

### 1.1 项目信息
- **项目名称**：Modbus 地址与参数智能扫描工具
- **技术栈**：C# + Avalonia
- **目标平台**：Windows / macOS / Linux
- **开发周期**：预估 8-12 周

### 1.2 开发阶段
1. **Phase 1**：项目初始化与基础架构（1-2 周）
2. **Phase 2**：Modbus 协议层实现（2-3 周）
3. **Phase 3**：扫描策略引擎（2-3 周）
4. **Phase 4**：UI 开发与集成（2-3 周）
5. **Phase 5**：测试与优化（1-2 周）

---

## 二、详细开发计划

### Phase 1：项目初始化与基础架构（Week 1-2）

#### 1.1 项目搭建
- [ ] 创建 Avalonia 项目
- [ ] 配置项目结构（分层架构）
- [ ] 配置依赖管理（NuGet）
- [ ] 配置跨平台构建

#### 1.2 技术选型确认
- [ ] 选择 Modbus 库（推荐：NModbus4 或 EasyModbus）
- [ ] 确认串口库（System.IO.Ports / SerialPortStream）
- [ ] 确认日志库（Serilog / NLog）
- [ ] 确认配置管理库（可选）

#### 1.3 项目结构设计
```
FindModbus/
├── FindModbus.Core/          # 核心业务逻辑
│   ├── Models/               # 数据模型
│   ├── Services/             # 业务服务
│   └── Strategies/           # 扫描策略
├── FindModbus.Protocol/       # Modbus 协议层
│   ├── ModbusTcp/            # TCP 实现
│   └── ModbusRtu/            # RTU 实现
├── FindModbus.UI/            # UI 层（Avalonia）
│   ├── Views/                # 视图
│   ├── ViewModels/           # 视图模型
│   └── Controls/             # 自定义控件
└── FindModbus.Tests/         # 单元测试
```

#### 1.4 基础模型定义
- [ ] 设备连接参数模型
- [ ] 扫描配置模型
- [ ] 扫描结果模型
- [ ] 可信度评分模型

**交付物**：
- 项目框架搭建完成
- 基础模型定义完成
- 开发环境配置完成

---

### Phase 2：Modbus 协议层实现（Week 3-5）

#### 2.1 Modbus TCP 实现
- [ ] TCP 连接管理
- [ ] MBAP 帧封装/解析
- [ ] 功能码 01/02/03/04 实现
- [ ] 异常码处理
- [ ] 超时与重试机制
- [ ] 单元测试

#### 2.2 Modbus RTU 实现
- [ ] 串口连接管理
- [ ] RTU 帧封装/解析
- [ ] CRC 校验实现
- [ ] 功能码 01/02/03/04 实现
- [ ] 异常码处理
- [ ] 超时与重试机制
- [ ] 串口异常恢复
- [ ] 单元测试

#### 2.3 协议抽象层
- [ ] IModbusClient 接口定义
- [ ] ModbusTcpClient 实现
- [ ] ModbusRtuClient 实现
- [ ] 统一异常处理

**交付物**：
- Modbus TCP/RTU 协议层完成
- 单元测试覆盖 > 80%
- 协议层文档

---

### Phase 3：扫描策略引擎（Week 6-8）

#### 3.1 参数组合生成器
- [ ] RTU 参数组合生成
- [ ] 参数优先级排序
- [ ] 内置参数模板
- [ ] 用户自定义优先级支持

#### 3.2 TCP 扫描策略
- [ ] IP 地址/段解析
- [ ] Slave ID 范围扫描
- [ ] 功能码组合扫描
- [ ] 寄存器地址范围扫描
- [ ] 扫描任务调度

#### 3.3 RTU 扫描策略
- [ ] 参数组合遍历
- [ ] 快速失败机制
  - [ ] CRC 错误检测
  - [ ] 无响应超时
  - [ ] 异常码连续判定
- [ ] 扫描任务调度

#### 3.4 可信度评估引擎
- [ ] 响应一致性分析
- [ ] 多功能码验证
- [ ] 数据稳定性分析
- [ ] 综合评分计算
- [ ] 结果过滤与排序

#### 3.5 扫描任务管理
- [ ] 异步扫描任务
- [ ] 任务暂停/恢复/取消
- [ ] 进度跟踪
- [ ] 结果收集与聚合

**交付物**：
- 扫描策略引擎完成
- 可信度评估算法实现
- 单元测试覆盖核心逻辑

---

### Phase 4：UI 开发与集成（Week 9-11）

#### 4.1 主界面布局
- [ ] 三栏布局实现
- [ ] 响应式布局适配
- [ ] 主题样式定义（工程感）

#### 4.2 左侧面板：连接与配置
- [ ] 连接模式选择（TCP/RTU）
- [ ] TCP 配置界面
  - [ ] IP 地址输入
  - [ ] 端口配置
  - [ ] IP 段支持
- [ ] RTU 配置界面
  - [ ] 串口选择下拉
  - [ ] 参数配置（波特率、校验位等）
  - [ ] 串口检测
- [ ] 扫描范围配置
- [ ] 基础/高级模式切换
- [ ] 开始/暂停/停止按钮

#### 4.3 中间面板：进度与日志
- [ ] 进度条组件
- [ ] 当前参数显示
- [ ] 统计信息（已尝试/剩余）
- [ ] 日志显示组件
  - [ ] 实时日志流
  - [ ] 日志格式化（可读）
  - [ ] 日志过滤
  - [ ] 日志搜索
- [ ] 滚动与自动滚动

#### 4.4 右侧面板：结果展示
- [ ] 设备信息卡片
- [ ] 成功参数列表
  - [ ] 参数详情显示
  - [ ] 可信度评分显示
  - [ ] 结果排序
- [ ] 寄存器列表
  - [ ] 功能码分组
  - [ ] 地址范围显示
  - [ ] 数据示例
- [ ] 结果详情展开/折叠

#### 4.5 数据导出功能
- [ ] 导出菜单/按钮
- [ ] JSON 导出实现
- [ ] CSV 导出实现
- [ ] Excel 导出实现（可选）
- [ ] 文本报告导出

#### 4.6 参数模板管理
- [ ] 模板保存功能
- [ ] 模板加载功能
- [ ] 模板管理界面

#### 4.7 MVVM 架构实现
- [ ] ViewModel 基类
- [ ] 命令绑定
- [ ] 数据绑定
- [ ] 异步操作绑定

**交付物**：
- 完整 UI 界面
- UI 与业务逻辑集成
- 用户交互流程完整

---

### Phase 5：测试与优化（Week 12）

#### 5.1 功能测试
- [ ] TCP 扫描测试
- [ ] RTU 扫描测试
- [ ] 可信度评估测试
- [ ] 导出功能测试
- [ ] 异常场景测试

#### 5.2 性能测试
- [ ] 扫描性能测试
- [ ] UI 响应性能测试
- [ ] 内存泄漏检测
- [ ] 长时间运行稳定性测试

#### 5.3 跨平台测试
- [ ] Windows 测试
- [ ] macOS 测试
- [ ] Linux 测试
- [ ] 串口跨平台兼容性测试

#### 5.4 优化工作
- [ ] 性能瓶颈优化
- [ ] UI 体验优化
- [ ] 错误提示优化
- [ ] 日志优化

#### 5.5 文档编写
- [ ] 用户使用手册
- [ ] 开发者文档
- [ ] API 文档
- [ ] 部署文档

**交付物**：
- 测试报告
- 优化后的稳定版本
- 完整文档

---

## 三、技术难点与解决方案

### 3.1 跨平台串口访问
**难点**：Windows/macOS/Linux 串口 API 差异
**解决方案**：
- 使用 SerialPortStream 库（跨平台）
- 或封装 System.IO.Ports（.NET 6+ 支持跨平台）

### 3.2 异步扫描不阻塞 UI
**难点**：长时间扫描任务需要保持 UI 响应
**解决方案**：
- 使用 async/await 异步模式
- Task 并行处理
- 进度回调更新 UI

### 3.3 可信度评分算法
**难点**：如何准确评估扫描结果可信度
**解决方案**：
- 多维度评分模型
- 可配置权重
- 实际测试调优

### 3.4 快速失败机制
**难点**：如何快速识别无效参数组合
**解决方案**：
- CRC 校验优先
- 超时阈值设置
- 异常码模式识别

---

## 四、风险与应对

### 4.1 技术风险
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| Modbus 库兼容性问题 | 高 | 提前验证，准备备选方案 |
| 跨平台串口问题 | 中 | 使用成熟库，充分测试 |
| 性能不达标 | 中 | 早期性能测试，优化算法 |

### 4.2 进度风险
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 扫描策略复杂度超预期 | 中 | 分阶段实现，先基础后优化 |
| UI 开发时间超预期 | 中 | 使用 UI 框架，简化设计 |

---

## 五、里程碑

### Milestone 1：基础架构完成（Week 2）
- 项目框架搭建
- 基础模型定义
- 技术选型确认

### Milestone 2：协议层完成（Week 5）
- Modbus TCP/RTU 实现
- 单元测试通过

### Milestone 3：扫描引擎完成（Week 8）
- 扫描策略实现
- 可信度评估完成

### Milestone 4：UI 完成（Week 11）
- 完整 UI 界面
- 功能集成完成

### Milestone 5：发布准备（Week 12）
- 测试完成
- 文档完成
- 可发布版本

---

## 六、资源需求

### 6.1 开发环境
- Visual Studio 2022 / Rider
- .NET 6/7/8 SDK
- Avalonia 模板

### 6.2 测试设备
- Modbus TCP 设备（或模拟器）
- Modbus RTU 设备（或 USB-RS485 转换器）
- 多平台测试机器

### 6.3 依赖库
- Avalonia UI
- Modbus 库（待选型）
- 串口库（待选型）
- 日志库（Serilog/NLog）
- Excel 导出库（可选，如 EPPlus）

---

## 七、后续迭代计划（V2.0+）

### 7.1 功能增强
- [ ] 扫描结果对比功能
- [ ] 批量设备扫描
- [ ] 扫描任务调度
- [ ] 云端模板库

### 7.2 性能优化
- [ ] 并行扫描优化
- [ ] 智能跳过算法
- [ ] 缓存机制

### 7.3 用户体验
- [ ] 扫描向导
- [ ] 结果可视化图表
- [ ] 多语言支持

---

## 八、开发规范

### 8.1 代码规范
- 遵循 C# 编码规范
- 使用 XML 注释
- 命名清晰有意义

### 8.2 Git 工作流
- 主分支：main
- 开发分支：develop
- 功能分支：feature/xxx
- 提交信息规范：`type: description`

### 8.3 测试要求
- 核心逻辑单元测试覆盖率 > 80%
- 关键路径集成测试
- 跨平台兼容性测试

---

## 九、项目启动检查清单

- [ ] 项目仓库创建
- [ ] 开发环境配置
- [ ] 技术选型确认
- [ ] 项目结构创建
- [ ] 依赖包安装
- [ ] 第一个 Hello World 运行成功
- [ ] 团队沟通渠道建立

